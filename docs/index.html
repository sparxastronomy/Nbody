<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <meta name="author" content="Bipradeep Saha" />
    <title>N-Body Simulation</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
        background-color: #f8f8f8;
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ef2929;
      } /* Alert */
      code span.an {
        color: #8f5902;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #c4a000;
      } /* Attribute */
      code span.bn {
        color: #0000cf;
      } /* BaseN */
      code span.cf {
        color: #204a87;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4e9a06;
      } /* Char */
      code span.cn {
        color: #000000;
      } /* Constant */
      code span.co {
        color: #8f5902;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #8f5902;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #8f5902;
        font-weight: bold;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #204a87;
      } /* DataType */
      code span.dv {
        color: #0000cf;
      } /* DecVal */
      code span.er {
        color: #a40000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #0000cf;
      } /* Float */
      code span.fu {
        color: #000000;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #8f5902;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #204a87;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #ce5c00;
        font-weight: bold;
      } /* Operator */
      code span.ot {
        color: #8f5902;
      } /* Other */
      code span.pp {
        color: #8f5902;
        font-style: italic;
      } /* Preprocessor */
      code span.sc {
        color: #000000;
      } /* SpecialChar */
      code span.ss {
        color: #4e9a06;
      } /* SpecialString */
      code span.st {
        color: #4e9a06;
      } /* String */
      code span.va {
        color: #000000;
      } /* Variable */
      code span.vs {
        color: #4e9a06;
      } /* VerbatimString */
      code span.wa {
        color: #8f5902;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
    <!-- Bootstrap 4.5.0 stylesheet -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/mods.css" />
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <![endif]-->
    <!-- <script data-main="scripts/main" src="js/require.js"></script> -->
    <!-- Load React. -->
    <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
    <!--  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script> -->
  </head>
  <body class="d-flex flex-column">
    <nav id="TOC" class="navbar navbar-dark bg-dark">
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <a href="#" class="ml-5 mr-auto navbar-brand"
        >N-Body Simulation<br /><span style="font-size: smaller">
          by <i>Bipradeep Saha</i></span
        ></a
      >
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul>
          <li><a href="#d-nbody-simulation">3D Nbody Simulation</a></li>
          <li><a href="#d-nbody-simulation-1">2D Nbody Simulation</a></li>
        </ul>
      </div>
    </nav>

    <!-- <nav class="navbar navbar-dark navbar-expand-md bg-dark mb-4">
<p class="author">Bipradeep Saha</p>
</nav>
 -->

    <main role="main" class="flex-fill">
      <div class="container my-5">
        <p>
          <a href="https://entangled.github.io/"
            ><img
              src="https://img.shields.io/badge/entangled-Use%20the%20source!-%2300aeff"
              alt="Entangled badge"
          /></a>
        </p>
        <p>
          This repository contains codes for doing N-Body simulation using
          particle-pair and particle mesh methods.
        </p>
        <h1 id="d-nbody-simulation">3D Nbody Simulation</h1>
        <p>
          This is simple N body simulation without any implemantation of
          cosmological models.
        </p>
        <h2 id="instructions">Instructions</h2>
        <p>To run the code, you need to have installed:</p>
        <ul>
          <li>Python 3.8</li>
          <li>Numpy</li>
          <li>Numba</li>
          <li>Matplolib</li>
        </ul>
        <p>Run with:</p>
        <div class="sourceCode" id="cb1">
          <pre
            class="sourceCode bash"
          ><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">$ <span class="ex">python</span> -m nbody3d.nbody</a></code></pre>
        </div>
        <h2 id="working">Working</h2>
        <p>
          The code is a simple implementation of particle - pair method, where
          force is computed for each pair and then summed over for each such
          pair. After that using the Leapfrog integration we calculate the
          postion and velocity, and iterate over again.
        </p>
        <h3
          id="there-are-three-main-functions-required-for-doing-the-simualation."
        >
          There are three main functions required for doing the simualation.
        </h3>
        <div class="annotated-code">
          <p>
            <span><em>«accleration»=</em></span>
          </p>
          <div class="sourceCode" id="accleration">
            <pre
              class="sourceCode python"
            ><code class="sourceCode python"><a class="sourceLine" id="accleration-1" title="1">accleration(pos, mass, G, softening)</a></code></pre>
          </div>
        </div>
        <p>
          This function calculates accelration from particle-pair method.<br />
          Suppose that the position of particle of interest
          <span class="math inline">\(j\)</span> be
          <span class="math inline">\(x_j\)</span> and then there are
          <span class="math inline">\(N\)</span> such particles. Then we
          calulate the relative vector between each such pair i.e
          <span class="math inline"
            >\(\vec{r_{ji}} = \vec{x_j} - \vec{x_i}\)</span
          >
          where <span class="math inline">\(i=\{1,2,\ldots,N\}\)</span>. Then
          using Newton’s Law of graviation we calulate accleration for each such
          pairs and thus the net accleration becomes
        </p>
        <p>
          <span class="math display"
            >\[ \mathbf{a}_j = G\sum_{i\neq j}m_i\frac{r_{ji}}{|r_{ji}|^3}
            \]</span
          >
          we use the softening parameter so that the relative distance never
          becomes zero.<br />
          This function returns a
          <span class="math inline">\(N\times 3\)</span> matrix conatining the
          accleration vector i.e
          <span class="math inline">\([a_x,~a_y, ~a_z]\)</span> of each
          particle.
        </p>
        <div class="annotated-code">
          <p>
            <span><em>«energy»=</em></span>
          </p>
          <div class="sourceCode" id="energy">
            <pre
              class="sourceCode python"
            ><code class="sourceCode python"><a class="sourceLine" id="energy-1" title="1">energy(pos, vel, mass, G)</a></code></pre>
          </div>
        </div>
        <p>
          This function calculates the energy the of the total system.<br />
          The <code>vel</code> parameter here is a
          <span class="math inline">\(N\times 3\)</span> matrix that contains
          the velocity vector of each particle,
          <span class="math inline">\([v_x,~v_y,~v_z]\)</span> so for the
          particle <span class="math inline">\(i\)</span> its easy to calculate
          the magnitude as
          <span class="math inline"
            >\(v_i = \sqrt{v_{i,x}^2 + v_{i,y}^2 + v_{i,z}^2}\)</span
          >
          Thus we can calulate the kinetic energy of each particle as
          <span class="math inline">\(\dfrac{mv_j^2}{2}\)</span>.
        </p>
        <p>
          Then we calculate Gravitional Potential Energy between each pair, for
          that we need the relative distance between each particle which we do
          the same way as before. Then the Graviational potential energy for
          particle <span class="math inline">\(i\)</span> and
          <span class="math inline">\(j\)</span> will be
          <span class="math inline">\(-G\dfrac{m_im_j}{r_{ij}}\)</span>.
        </p>
        <p>
          We sum the kinetic energy for each particle and potential energy for
          each such pair. Thus the total energy is:
          <span class="math display"
            >\[E_{tot} = \sum_{i=1}^N \frac{m_iv_i^2}{2} ~~ - \sum_{1\leq i \leq
            j\leq N}G\dfrac{m_im_j}{r_{ij}}\]</span
          >
        </p>
        <p>
          For a good simulation, the total, energy should be near 0 through out
          the simulation and should remain more or less constant.
        </p>
        <div class="annotated-code">
          <p>
            <span><em>«main»=</em></span>
          </p>
          <div class="sourceCode" id="main">
            <pre
              class="sourceCode python"
            ><code class="sourceCode python"><a class="sourceLine" id="main-1" title="1">main(N, tEnd, dt, softening<span class="op">=</span><span class="fl">0.1</span>, energyplot<span class="op">=</span><span class="va">False</span>, plotRealTime<span class="op">=</span><span class="va">True</span>)</a></code></pre>
          </div>
        </div>
        <p>
          This funtion is the main function which runs the simulation. The
          paramerters are self-explanatory and are descibed in the the
          <code>nbody.py</code> also.<br />
          Don’t keep the Number of particles too High, as this code is
          vectorized, so it have a drawback of large memory requirement.<br />
          This function initializes the inital grid and perturbation. If you
          don’t want the perturbations, then you can distribute the paricles
          randomly as well, by <em>un-commenting</em> this line :<br />
          <code>pos = np.random.randn(N, 3)</code>
        </p>
        <p>
          Note that the grid form is a cube, so make sure that the
          <span class="math inline">\(N\)</span> you chose is a cube of some
          integer.
        </p>
        <h2 id="sample-output">Sample output</h2>
        <p>
          I ran the code for <span class="math inline">\(N = 1000\)</span> and
          here is the output
        </p>
        <figure>
          <img
            src="figures/nbody3d/nbody1000.png"
            alt="Scatter plot after running the simulation"
          />
          <figcaption>Scatter plot after running the simulation</figcaption>
        </figure>
        <p>and here is the energy associated with the evolution</p>
        <figure>
          <img
            src="figures/nbody3d/nbody1000eng1.png"
            alt="Energy evolution plot of the simulation"
          />
          <figcaption>Energy evolution plot of the simulation</figcaption>
        </figure>
        <p><span class="math display">\[ \text{Have fun with this}\]</span></p>
        <h2 id="credits">Credits</h2>
        <p>
          This code implementation is based on the code implemented by
          <a href="https://github.com/pmocz/nbody-python">Phillip Mocaz</a>
        </p>
        <h1 id="d-nbody-simulation-1">2D Nbody Simulation</h1>
        <p>
          This simulation will incorporate Friedmann’s Equation and will be a
          more realistics simulation
        </p>
      </div>
    </main>

    <!-- Bootstrap 4.5.0 -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
      integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
      crossorigin="anonymous"
    ></script>

    <!-- Mathjax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
  </body>
</html>
